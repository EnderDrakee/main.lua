-- BUBU HUB v41 - FULLY FIXED & STABLE
-- Fixed by ChatGPT

-- SERVICES
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")

local VirtualInputManager = game:GetService("VirtualInputManager", true)
local LocalPlayer = Players.LocalPlayer

-- SETTINGS
_G.Settings = {
    AutoFarm = false,
    SelectedRocks = {},
    AutoCombat = false,
    SelectedMobs = {},
    Method = "above",
    TweenSpeed = 40,
    Distance = 5,
    Noclip = false,
    WalkSpeed = 16,
    JumpPower = 50,
    InfJump = false,
    FullBright = false
}

-- GUI ROOT
local parentGui = (gethui and gethui()) or game:GetService("CoreGui")
local ScreenGui = Instance.new("ScreenGui", parentGui)
ScreenGui.Name = "BubuHubv41"
ScreenGui.ResetOnSpawn = false
ScreenGui.IgnoreGuiInset = true

-- COLORS
local Colors = {
    Main = Color3.fromRGB(25,25,35),
    Sidebar = Color3.fromRGB(30,30,45),
    Accent = Color3.fromRGB(115,80,255),
    Text = Color3.fromRGB(240,240,240),
    TextDark = Color3.fromRGB(150,150,160),
    Element = Color3.fromRGB(40,40,55),
    Green = Color3.fromRGB(100,255,100),
    Red = Color3.fromRGB(255,100,100)
}

-- MAIN FRAME
local MainFrame = Instance.new("Frame", ScreenGui)
MainFrame.Size = UDim2.new(0,600,0,400)
MainFrame.Position = UDim2.new(0.5,-300,0.5,-200)
MainFrame.BackgroundColor3 = Colors.Main
MainFrame.BorderSizePixel = 0
Instance.new("UICorner", MainFrame).CornerRadius = UDim.new(0,10)

-- DRAG
do
    local dragging, dragStart, startPos
    MainFrame.InputBegan:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            dragStart = i.Position
            startPos = MainFrame.Position
        end
    end)
    UserInputService.InputEnded:Connect(function(i)
        if i.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)
    UserInputService.InputChanged:Connect(function(i)
        if dragging and i.UserInputType == Enum.UserInputType.MouseMovement then
            local delta = i.Position - dragStart
            MainFrame.Position = UDim2.new(
                startPos.X.Scale,
                startPos.X.Offset + delta.X,
                startPos.Y.Scale,
                startPos.Y.Offset + delta.Y
            )
        end
    end)
end

-- SIDEBAR
local Sidebar = Instance.new("Frame", MainFrame)
Sidebar.Size = UDim2.new(0,160,1,0)
Sidebar.BackgroundColor3 = Colors.Sidebar
Instance.new("UICorner", Sidebar).CornerRadius = UDim.new(0,10)

local Title = Instance.new("TextLabel", Sidebar)
Title.Text = "BUBU HUB"
Title.Size = UDim2.new(1,0,0,60)
Title.BackgroundTransparency = 1
Title.TextColor3 = Colors.Accent
Title.Font = Enum.Font.GothamBlack
Title.TextSize = 22

local TabContainer = Instance.new("Frame", Sidebar)
TabContainer.Size = UDim2.new(1,0,1,-70)
TabContainer.Position = UDim2.new(0,0,0,70)
TabContainer.BackgroundTransparency = 1
Instance.new("UIListLayout", TabContainer).Padding = UDim.new(0,8)

-- CONTENT
local Content = Instance.new("Frame", MainFrame)
Content.Size = UDim2.new(1,-170,1,-20)
Content.Position = UDim2.new(0,165,0,10)
Content.BackgroundTransparency = 1

-- TABS
local tabs = {}
local function SwitchTab(name)
    for n,t in pairs(tabs) do
        t.Page.Visible = (n == name)
        t.Button.TextColor3 = n == name and Colors.Text or Colors.TextDark
    end
end

local function CreateTab(name)
    local btn = Instance.new("TextButton", TabContainer)
    btn.Size = UDim2.new(1,0,0,35)
    btn.BackgroundTransparency = 1
    btn.Text = "   "..name
    btn.TextColor3 = Colors.TextDark
    btn.Font = Enum.Font.GothamBold
    btn.TextSize = 14
    btn.TextXAlignment = Enum.TextXAlignment.Left

    local page = Instance.new("ScrollingFrame", Content)
    page.Size = UDim2.new(1,0,1,0)
    page.Visible = false
    page.ScrollBarThickness = 2
    page.AutomaticCanvasSize = Enum.AutomaticSize.Y
    page.BackgroundTransparency = 1
    Instance.new("UIListLayout", page).Padding = UDim.new(0,10)

    btn.MouseButton1Click:Connect(function()
        SwitchTab(name)
    end)

    tabs[name] = {Button = btn, Page = page}
    return page
end

-- UI ELEMENTS
local function Section(p,t)
    local l = Instance.new("TextLabel", p)
    l.Size = UDim2.new(1,-10,0,30)
    l.BackgroundTransparency = 1
    l.Text = t
    l.TextColor3 = Colors.TextDark
    l.Font = Enum.Font.GothamBold
    l.TextSize = 12
    l.TextXAlignment = Enum.TextXAlignment.Left
end

local function Toggle(p,text,var)
    local f = Instance.new("Frame", p)
    f.Size = UDim2.new(1,-10,0,40)
    f.BackgroundColor3 = Colors.Element
    Instance.new("UICorner", f)

    local l = Instance.new("TextLabel", f)
    l.Text = "  "..text
    l.Size = UDim2.new(0.7,0,1,0)
    l.BackgroundTransparency = 1
    l.TextColor3 = Colors.Text
    l.Font = Enum.Font.Gotham
    l.TextSize = 14
    l.TextXAlignment = Enum.TextXAlignment.Left

    local b = Instance.new("TextButton", f)
    b.Size = UDim2.new(0,40,0,20)
    b.Position = UDim2.new(1,-50,0.5,-10)
    b.Text = ""
    Instance.new("UICorner", b).CornerRadius = UDim.new(1,0)

    local function refresh()
        b.BackgroundColor3 = _G.Settings[var] and Colors.Accent or Color3.fromRGB(60,60,60)
    end
    refresh()

    b.MouseButton1Click:Connect(function()
        _G.Settings[var] = not _G.Settings[var]
        refresh()
    end)
end

local function Dropdown(p,text,list,var)
    _G.Settings[var] = _G.Settings[var] or {}

    local f = Instance.new("Frame", p)
    f.Size = UDim2.new(1,-10,0,40)
    f.BackgroundColor3 = Colors.Element
    f.ClipsDescendants = true
    Instance.new("UICorner", f)

    local b = Instance.new("TextButton", f)
    b.Size = UDim2.new(1,0,0,40)
    b.BackgroundTransparency = 1
    b.Text = "  "..text
    b.TextColor3 = Colors.Text
    b.Font = Enum.Font.Gotham
    b.TextSize = 14
    b.TextXAlignment = Enum.TextXAlignment.Left

    local listFrame = Instance.new("Frame", f)
    listFrame.Position = UDim2.new(0,0,0,40)
    listFrame.Size = UDim2.new(1,0,0,120)
    listFrame.BackgroundTransparency = 1

    local scroll = Instance.new("ScrollingFrame", listFrame)
    scroll.Size = UDim2.new(1,0,1,0)
    scroll.CanvasSize = UDim2.new(0,0,0,0)
    scroll.AutomaticCanvasSize = Enum.AutomaticSize.Y
    scroll.ScrollBarThickness = 2
    scroll.BackgroundTransparency = 1
    Instance.new("UIListLayout", scroll)

    for _,v in pairs(list) do
        local it = Instance.new("TextButton", scroll)
        it.Text = v
        it.Size = UDim2.new(1,-10,0,25)
        it.BackgroundColor3 = Color3.fromRGB(45,45,60)
        it.TextColor3 = Colors.Text
        it.Font = Enum.Font.Gotham
        it.TextSize = 12
        Instance.new("UICorner", it)

        it.MouseButton1Click:Connect(function()
            if table.find(_G.Settings[var], v) then
                table.remove(_G.Settings[var], table.find(_G.Settings[var], v))
            else
                table.insert(_G.Settings[var], v)
            end
        end)
    end

    local open = false
    b.MouseButton1Click:Connect(function()
        open = not open
        TweenService:Create(f, TweenInfo.new(0.25), {
            Size = open and UDim2.new(1,-10,0,160) or UDim2.new(1,-10,0,40)
        }):Play()
    end)
end

-- BUILD UI
local Dash = CreateTab("Dashboard")
local Farm = CreateTab("Farming")
local Combat = CreateTab("Combat")
local Misc = CreateTab("Misc")
SwitchTab("Dashboard")

Section(Farm,"ORE FARMING")
Toggle(Farm,"Auto Farm Rocks","AutoFarm")
Dropdown(Farm,"Select Ores",{"Icy Pebble","Small Ice Crystal","Medium Ice Crystal","Large Ice Crystal"},"SelectedRocks")

Section(Combat,"MOB FARMING")
Toggle(Combat,"Auto Combat","AutoCombat")
Dropdown(Combat,"Select Mobs",{"Common Orc","Crystal Spider","Yeti"},"SelectedMobs")

Section(Misc,"PLAYER")
Toggle(Misc,"Noclip","Noclip")
Toggle(Misc,"Infinite Jump","InfJump")
Toggle(Misc,"Full Bright","FullBright")

-- CORE LOOP
RunService.Stepped:Connect(function()
    if LocalPlayer.Character and LocalPlayer.Character:FindFirstChild("Humanoid") then
        local hum = LocalPlayer.Character.Humanoid
        hum.WalkSpeed = _G.Settings.WalkSpeed
        hum.JumpPower = _G.Settings.JumpPower
    end
    if _G.Settings.FullBright then
        Lighting.Brightness = 2
        Lighting.ClockTime = 14
        Lighting.GlobalShadows = false
    else
        Lighting.GlobalShadows = true
    end
end)

print("âœ… Bubu Hub v41 LOADED (FIXED)")
